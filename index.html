<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>MIR Tracking</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; background: #f7f7f7; }
    h1 { color: #003366; }
    .panel { background: white; border: 1px solid #ccc; padding: 15px; margin-top: 20px; border-radius: 10px; max-width: 400px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
    input, button { margin: 5px 0; padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 5px; }
    button { background: #003366; color: white; font-weight: bold; cursor: pointer; }
    button:hover { background: #0055aa; }
    img { max-width: 100%; display: block; margin-top: 10px; border-radius: 5px; }
    #mensajeEmpleado { font-weight: bold; }
  </style>
</head>
<body>

  <h1>üì¶ MIR Tracking</h1>

  <!-- PANEL EMPLEADOS -->
  <div class="panel" id="panelEmpleado">
    <h2>Panel de Empleados</h2>
    <input type="password" id="codigoEmpleado" placeholder="C√≥digo de seguridad">
    <div id="accesoEmpleado" style="display:none;">
      <input type="text" id="trackingEmpleado" placeholder="C√≥digo de rastreo">
      <input type="file" id="fotoEmpleado" accept="image/*">
      <button onclick="subirFoto()">üì∏ Subir Foto</button>
    </div>
    <p id="mensajeEmpleado"></p>
  </div>

  <!-- BUSCADOR CLIENTES -->
  <div class="panel">
    <h2>Rastreo de Paquetes</h2>
    <input type="text" id="trackingInput" placeholder="Ingresa tu n√∫mero de rastreo">
    <button onclick="buscarTracking()">Buscar</button>
    <div id="resultado"></div>
  </div>

<script>
let accesoValido = false;
const SCRIPT_URL = 'TU_URL_DE_SCRIPT'; // üëà Pega aqu√≠ la URL de tu Apps Script

// ‚úÖ Verificar c√≥digo de seguridad
document.getElementById('codigoEmpleado').addEventListener('change', async () => {
  const code = document.getElementById('codigoEmpleado').value.trim();
  const res = await fetch(`${SCRIPT_URL}?checkCode=${encodeURIComponent(code)}`);
  const txt = await res.text();
  if (txt === 'OK') {
    accesoValido = true;
    document.getElementById('accesoEmpleado').style.display = 'block';
    document.getElementById('mensajeEmpleado').textContent = '‚úÖ Acceso concedido';
    document.getElementById('mensajeEmpleado').style.color = 'green';
  } else {
    accesoValido = false;
    document.getElementById('accesoEmpleado').style.display = 'none';
    document.getElementById('mensajeEmpleado').textContent = '‚ùå C√≥digo inv√°lido';
    document.getElementById('mensajeEmpleado').style.color = 'red';
  }
});

// üì§ Subir foto
async function subirFoto() {
  if (!accesoValido) {
    alert('C√≥digo de seguridad inv√°lido');
    return;
  }
  const tracking = document.getElementById('trackingEmpleado').value.trim();
  const file = document.getElementById('fotoEmpleado').files[0];
  const code = document.getElementById('codigoEmpleado').value.trim();

  if (!tracking || !file) {
    alert('Debe ingresar el c√≥digo de rastreo y seleccionar una foto.');
    return;
  }

  const formData = new FormData();
  formData.append('tracking', tracking);
  formData.append('foto', file);
  formData.append('key', code);

  const response = await fetch(SCRIPT_URL, { method: 'POST', body: formData });
  const result = await response.text();
  alert(result);
  document.getElementById('trackingEmpleado').value = "";
  document.getElementById('fotoEmpleado').value = "";
}

// üîé Buscar imagen por n√∫mero de rastreo
async function buscarTracking() {
  const codigo = document.getElementById('trackingInput').value.trim();
  if (!codigo) {
    alert('Ingrese un n√∫mero de rastreo');
    return;
  }
  const response = await fetch(`${SCRIPT_URL}?getImage=${encodeURIComponent(codigo)}`);
  const imageUrl = await response.text();

  const output = document.getElementById('resultado');
  if (imageUrl && imageUrl !== 'NOT_FOUND') {
    output.innerHTML = `<p><strong>C√≥digo:</strong> ${codigo}</p><img src="${imageUrl}" alt="Foto del paquete">`;
  } else {
    output.innerHTML = `<p><strong>C√≥digo:</strong> ${codigo}</p><p>üì∏ Sin imagen disponible</p>`;
  }
}
</script>
</body>
</html>
